# ESP32-S3-BOX-Lite 完整原理图解析（补充版）

## 基于规格书的硬件规格确认

---

## 一、核心系统规格（规格书确认）

| 参数 | 规格值 | 原理图对应 |
|:---|:---|:---|
| **SoC** | ESP32-S3 Dual-Core | ESP32-S3-WROOM-1 |
| **CPU** | Xtensa® 32bit LX7 @ 240MHz | 内置 |
| **Flash** | 16MB Quad SPI @ 120MHz | 模组内置 |
| **SRAM** | 512KB | 内置 |
| **PSRAM** | 8MB Octal SPI @ 120MHz | 模组内置 |
| **Wi-Fi** | IEEE 802.11 b/g/n | 模组内置 |
| **Bluetooth** | BLE 5.0 + Mesh | 模组内置 |

---

## 二、LCD显示系统详解（规格书确认 ST7789V）

### 2.1 LCD驱动IC：ST7789V

根据规格书，LCD驱动IC为 **ST7789V**，这是一款常见的240×320分辨率TFT LCD驱动芯片。

```
┌─────────────────────────────────────────┐
│      ST7789V 关键参数（规格书确认）        │
│                                         │
│ 分辨率: 240(RGB) × 320 像素              │
│ 接口: 4线SPI (Mode 0)                    │
│ 色彩: 16bit/18bit RGB                    │
│ 驱动电压: 2.5V-3.3V (IOVCC/VCI)          │
│ 背光: LED (需外部驱动)                    │
│                                         │
│ 原理图对应信号:                          │
│ ─────────────────────────────────────── │
│ LCD_DC  (GPIO4)  ──→ D/C#  数据/命令选择 │
│ LCD_SDA (GPIO6)  ──→ SDA   SPI数据      │
│ LCD_SCK (GPIO7)  ──→ SCL   SPI时钟      │
│ LCD_CS  (GPIO5)  ──→ CS#   片选         │
│ LCD_RST (GPIO48) ──→ RES#  复位         │
│                                         │
│ 背光控制:                               │
│ LCD_CTRL (GPIO45) ──→ 通过AO3401A控制   │
│                                         │
│ 电源:                                   │
│ VDD33 ──→ IOVCC (Pin15)  I/O电源 3.3V   │
│ VDD33 ──→ VCI   (Pin18)  模拟电源 3.3V   │
└─────────────────────────────────────────┘
```

### 2.2 LCD接口详细定义（J7: LCD_2P4_INCH）

```
┌─────────────────────────────────────────┐
│  FPC连接器 - 20Pin 0.5mm间距              │
│  规格书: 2.4-inch LCD, 240×320, SPI接口  │
│                                         │
│ Pin  信号名      连接到        说明      │
│ ─────────────────────────────────────── │
│ 1    LEDA    GPIO45→AO3401A  背光阳极   │
│ 2    LEDK1   -               背光阴极1  │
│ 3    LEDK2   -               背光阴极2  │
│ 4    LEDK3   -               背光阴极3  │
│ 5    LEDK4   -               背光阴极4  │
│ 6    GND     GND             地        │
│ 7    NC      -               空脚      │
│ 8    RESET   GPIO48          ST7789V复位│
│ 9    NC      -               空脚      │
│ 10   GND     GND             地        │
│ 11   LCD_DC  GPIO4           数据/命令  │
│ 12   LCD_SDA GPIO6           SPI MOSI   │
│ 13   LCD_SCK GPIO7           SPI SCK    │
│ 14   LCD_CS  GPIO5           片选       │
│ 15   IOVCC   VDD33 (3.3V)    I/O电源    │
│ 16   GND     GND             地        │
│ 17   NC      -               空脚      │
│ 18   VCI     VDD33 (3.3V)    模拟电源   │
│ 19   NC      -               空脚      │
│ 20   GND     GND             地        │
└─────────────────────────────────────────┘
```

### 2.3 背光驱动电路详解

```
┌─────────────────────────────────────────┐
│         背光控制电路 (GPIO45)            │
│                                         │
│                    VDD33                │
│                      │                  │
│                     R77(10K)            │
│                      │                  │
│                      ├──→ Gate          │
│                      │    (AO3401A P-ch)│
│    GPIO45 ──R171(0Ω)─┤                  │
│                      │    Source ── LEDA│
│                      │        │         │
│                      └────┬───┘         │
│                          Drain          │
│                            │            │
│                           GND           │
│                                         │
│ 工作原理:                               │
│ GPIO45 = High (3.3V): Vgs = 0V, 截止, 背光灭 │
│ GPIO45 = Low  (0V):   Vgs = -3.3V, 导通, 背光亮 │
│                                         │
│ 注: GPIO45为Strapping Pin，外部已下拉   │
│    启动时默认为低，背光默认开启           │
└─────────────────────────────────────────┘
```

### 2.4 ST7789V初始化关键时序

```
复位时序:
    RES# ──┐   ┌────────────────
           └───┘
              └──→ 至少10μs低电平
              
SPI配置 (Mode 0):
    CPOL = 0, CPHA = 0
    最大时钟: 40MHz (规格书确认)
    
写命令:
    D/C# = Low,  CS# = Low,  发送命令字节
写数据:
    D/C# = High, CS# = Low,  发送数据字节
```

---

## 三、音频系统详解（规格书确认）

### 3.1 音频链路总览（规格书确认）

```
┌─────────────────────────────────────────┐
│         音频系统架构（规格书确认）         │
│                                         │
│  输入:  Dual Mic ──→ ES7243 ──→ I2S    │
│  输出:  I2S ──→ ES8156 ──→ NS4150 ──→ Speaker
│                                         │
│  规格书确认:                            │
│  - ADC Model: ES7243                    │
│  - Codec Model: ES8156                  │
│  - PA Model: NS4150                     │
│  - Mute: Supported (通过PA_CTRL)        │
└─────────────────────────────────────────┘
```

### 3.2 ES7243E ADC详细配置

```
┌─────────────────────────────────────────┐
│      ES7243E - 双通道音频ADC             │
│      规格书: ES7243 (24-bit, 96kHz)     │
│                                         │
│ 电源配置:                               │
│ VDDA (Pin20) ── ADC_3V3 (模拟电源3.3V)   │
│ DVDD (Pin16) ── ADC_3V3 (数字电源3.3V)   │
│                                         │
│ 时钟配置 (I2S Slave Mode):              │
│ MCLK:  256×Fs (输入) ── GPIO2           │
│ SCLK:  64×Fs  (输入) ── GPIO17          │
│ LRCK:  Fs     (输入) ── GPIO47          │
│                                         │
│ 数据输出:                               │
│ SDOUT (Pin21) ── GPIO16 (I2S_ADC_SDOUT) │
│ 格式: I2S, 24-bit, MSB First            │
│                                         │
│ I2C控制:                                │
│ 地址: 0x20-0x27 (通过AD0-AD2配置)        │
│ SCL ── GPIO18                           │
│ SDA ── GPIO8                            │
│                                         │
│ 模拟输入:                               │
│ AINRP/MIC1P (Pin16) ── 右声道正输入      │
│ AINRN/MIC1N (Pin15) ── 右声道负输入      │
│ AINLP/MIC2P (Pin9)  ── 左声道正输入      │
│ AINLN/MIC2N (Pin10) ── 左声道负输入      │
│                                         │
│ 麦克风偏置:                             │
│ MICBIAS (Pin12) ── 提供1.2V偏置电压      │
│ 通过R1/R3(0Ω)连接到麦克风供电            │
└─────────────────────────────────────────┘
```

### 3.3 ES8156 DAC详细配置

```
┌─────────────────────────────────────────┐
│      ES8156 - 立体声音频DAC              │
│      规格书: ES8156 (24-bit, 96kHz)     │
│                                         │
│ 电源配置:                               │
│ PVDD (Pin6)   ── Aud_VDD (3.3V)         │
│ DVDD (Pin5)   ── Aud_VDD (3.3V)         │
│                                         │
│ I2S输入 (Slave Mode):                   │
│ SDIN  (Pin21) ── GPIO15 (I2S_DAC_SDIN)  │
│ SCLK  (Pin3)  ── GPIO17 (共享)          │
│ LRCK  (Pin4)  ── GPIO47 (共享)          │
│ MCLK  (Pin5)  ── GPIO2  (共享)          │
│                                         │
│ I2C控制:                                │
│ 地址: 0x10 (固定)                        │
│ SCL ── GPIO18 (共享)                    │
│ SDA ── GPIO8  (共享)                    │
│                                         │
│ 模拟输出:                               │
│ LOUTP (Pin15) ── DAC_AOUTLP ── 左正      │
│ LOUTN (Pin14) ── DAC_AOUTLN ── 左负      │
│ ROUTP (Pin12) ── DAC_AOUTRP ── 右正      │
│ ROUTN (Pin11) ── DAC_AOUTRN ── 右负      │
│                                         │
│ 输出模式:                               │
│ 1. 差分输出到功放 (本设计使用)            │
│ 2. 单端耳机驱动 (未使用)                  │
└─────────────────────────────────────────┘
```

### 3.4 NS4150功放详细配置

```
┌─────────────────────────────────────────┐
│      NS4150 - D类音频功率放大器           │
│      规格书: NS4150                     │
│                                         │
│ 电气参数:                               │
│ 供电电压: 2.5V - 5.5V (本设计: USB_5V)   │
│ 输出功率: 3W @ 4Ω, 5V                   │
│ 效率: >90% (D类)                        │
│ 关断电流: <1μA                          │
│                                         │
│ 引脚功能:                               │
│ CTRL (Pin1) ── GPIO46 (PA_CTRL)         │
│   High: 芯片关断 (静音)                  │
│   Low:  正常工作                         │
│                                         │
│ 输入 (差分):                            │
│ IN+ (Pin3) ── PA_IN+ ── DAC_AOUTLP      │
│ IN- (Pin4) ── PA_IN- ── DAC_AOUTLN      │
│                                         │
│ 输出 (差分):                            │
│ OUT+ (Pin8) ── PA_OUTL+ ── Speaker+     │
│ OUT- (Pin7) ── PA_OUTL- ── Speaker-     │
│                                         │
│ 电源:                                   │
│ VCC (Pin6)   ── USB_5V                  │
│ PVDD1 (Pin5) ── USB_5V                  │
│                                         │
│ 外围电路:                               │
│ Bypass (Pin2) ── C75(1uF) ── GND        │
│ 输出滤波: L4/L5(0Ω) + C79/C83(330pF)    │
└─────────────────────────────────────────┘
```

### 3.5 麦克风子板详细电路

```
┌─────────────────────────────────────────┐
│    双麦克风电路 (MIC V1.0 子板)          │
│    规格书: Dual Mic, Mute Supported     │
│                                         │
│ 麦克风1 (U1):                           │
│ MSM381A3729H9BPC (MEMS模拟麦克风)         │
│ ┌─────────────────┐                     │
│ │ Pin1: VDD       │←── ADC_MICBIAS12    │
│ │ Pin2: GND       │─── ADC_GND          │
│ │ Pin3: OUTPUT    │─── ADC_MIC1P        │
│ │ Pin4: GND       │─── ADC_GND          │
│ └─────────────────┘                     │
│                                         │
│ 外围电路:                               │
│ VDD: C1(10uF) + C2(0.1uF) 电源滤波       │
│ OUT: R2(0Ω) 串联电阻                    │
│      C3(220pF) + R5(0Ω) 低通滤波        │
│                                         │
│ 麦克风2 (U2): 相同电路                   │
│ 输出: ADC_MIC2P/ADC_MIC2N               │
│                                         │
│ FPC连接器 (J6):                         │
│ Pin1-2: ADC_MIC1P / ADC_MIC1N           │
│ Pin3-4: ADC_MIC2P / ADC_MIC2N           │
│ Pin5-6: ADC_GND                         │
│ Pin7-8: ADC_MICBIAS12                   │
│                                         │
│ ESD保护: D1-D4 (LESD8D3.3CAT5G)         │
│ 偏置保护: D5 (LESD8D3.3CAT5G)           │
└─────────────────────────────────────────┘
```

---

## 四、按键系统详解

### 4.1 机械按键

```
┌─────────────────────────────────────────┐
│         复位与启动按键                   │
│                                         │
│ SW1 - 复位键 (RST):                     │
│ 连接: MCU_RST ── SW1 ── GND             │
│ 功能: 低电平复位ESP32-S3                 │
│ ESD: D11 (LESD8D3.3CAT5G)               │
│ 测试点: TP38                            │
│                                         │
│ SW2 - 启动键 (BOOT):                    │
│ 连接: MCU_BOOT ── SW2 ── GND            │
│ 功能: 低电平进入下载模式                 │
│ ESD: D12 (LESD8D3.3CAT5G)               │
│ 测试点: TP37                            │
│                                         │
│ 使用方式:                               │
│ 下载固件: 按住SW2 → 按SW1 → 松开SW1 → 松开SW2
│ 普通复位: 按SW1                         │
└─────────────────────────────────────────┘
```

### 4.2 ADC按键（扩展功能）

```
┌─────────────────────────────────────────┐
│         ADC按键检测电路                  │
│                                         │
│ MCU_VDD ── R176(10K) ──┬── GPIO1 (ADC1_CH0)
│                        │               │
│                     C148(0.1uF)         │
│                        │               │
│                        └── PAD3 (2Pin)  │
│                                         │
│ 外部子板通过不同电阻分压产生不同电压:      │
│ 按键1: 直接接地 (0V)                     │
│ 按键2: 通过R1接地 (分压)                 │
│ 按键3: 通过R2接地 (分压)                 │
│ ...                                     │
│                                         │
│ ESP32-S3通过ADC读取电压值识别按键          │
│ 规格书未明确使用，为扩展功能               │
└─────────────────────────────────────────┘
```

---

## 五、电源系统详解（规格书确认）

### 5.1 电源输入（规格书确认）

```
┌─────────────────────────────────────────┐
│      USB-C 电源输入                      │
│      规格书: 5V - 2.0A Input            │
│                                         │
│ USB Type-C 16Pin 连接器 (J1)             │
│                                         │
│ VBUS (A4/B4/B9/A9): USB_5V (5V/2A max)  │
│ CC1/CC2 (A5/B5): 5.1K下拉，标识为Sink    │
│ D+/D- (A6/A7): USB2.0 数据线             │
│                                         │
│ 保护元件:                               │
│ D1 (B5819W): 5V防反接二极管              │
│ D8-D10: USB数据线TVS保护                 │
│ C6: 22uF/6.3V 输入滤波                   │
└─────────────────────────────────────────┘
```

### 5.2 电源树（规格书确认）

```
USB_5V (5V/2A输入)
    │
    ├──→ BUCK1 (SY8088AAC) ──→ MCU_VDD (3.3V/1A)
    │                            └──→ ESP32-S3 主控
    │                            └──→ 核心电路
    │
    ├──→ BUCK2 (SY8088AAC) ──→ VDD33 (3.3V/1A)
    │                            └──→ 外设供电
    │                            └──→ LCD, IMU等
    │
    ├──→ 直接输出 ──→ USB_5V (功放供电)
    │                    └──→ NS4150 (PA)
    │
    └──→ PMOD3 (J11) ──→ 5V扩展接口
```

### 5.3 BUCK电路详细参数

```
┌─────────────────────────────────────────┐
│      SY8088AAC 降压电路 ×2               │
│                                         │
│ 输入电压: 4.5V - 5.5V (USB_5V)          │
│ 输出电压: 3.3V (固定)                    │
│ 输出电流: 1A max                        │
│ 开关频率: 1MHz                          │
│ 效率: >95%                              │
│                                         │
│ BUCK1 (MCU_VDD):                        │
│ 电感: L1 = 2.2uH (20%, 3A)              │
│ 反馈电阻: R2=680K, R3=150K              │
│ Vout = 0.6 × (1 + 680/150) = 3.32V      │
│ 输出电容: C4(0.1uF) + C5(10uF)          │
│                                         │
│ BUCK2 (VDD33):                          │
│ 相同参数，独立输出                       │
│ 电感: L2 = 2.2uH                        │
│ 反馈电阻: R7=680K, R8=150K              │
└─────────────────────────────────────────┘
```

---

## 六、扩展接口详解

### 6.1 PMOD1 (J9) - 多功能扩展

```
┌─────────────────────────────────────────┐
│      PMOD1 2×6 排针 (带ESD保护)          │
│                                         │
│ 信号分配:                               │
│ [1-6]  数据信号 (带22Ω串联电阻)           │
│ [7-8]  GND                              │
│ [9-10] 3.3V电源                         │
│ [11-12] I2C信号                         │
│                                         │
│ 详细引脚:                               │
│ Pin1:  IO42_P  ── GPIO42 (FSPIHD)       │
│ Pin2:  IO21_P  ── GPIO21                │
│ Pin3:  IO1_P   ── GPIO1                 │
│ Pin4:  IO2_P   ── GPIO2 (I2S_MCLK)      │
│ Pin5:  USB_D-  ── GPIO19 (USB_DM)       │
│ Pin6:  USB_D+  ── GPIO20 (USB_DP)       │
│ Pin7:  GND                              │
│ Pin8:  GND                              │
│ Pin9:  3.3V                             │
│ Pin10: 3.3V                             │
│ Pin11: IO40    ── GPIO40 (I2C_SCL)      │
│ Pin12: IO41    ── GPIO41 (I2C_SDA)      │
│                                         │
│ ESD保护: D5, D6 (SRV05-4)               │
└─────────────────────────────────────────┘
```

### 6.2 PMOD2 (J10) - 高速SPI/UART

```
┌─────────────────────────────────────────┐
│      PMOD2 2×6 排针 (带ESD保护)          │
│                                         │
│ 信号分配:                               │
│ 类似PMOD1，侧重SPI和UART功能              │
│                                         │
│ 详细引脚:                               │
│ Pin1:  CS_P    ── 片选信号               │
│ Pin2:  IO_P    ── 通用IO                 │
│ Pin3:  IO_P    ── 通用IO                 │
│ Pin4:  CLK_P   ── 时钟信号               │
│ Pin5:  GND                              │
│ Pin6:  3.3V                             │
│ Pin7:  HD_P    ── GPIO9 (FSPIHD)        │
│ Pin8:  TXD_P   ── GPIO43 (U0TXD)        │
│ Pin9:  RXD_P   ── GPIO44 (U0RXD)        │
│ Pin10: WP_P    ── GPIO10 (FSPICS0)      │
│ Pin11: GND                              │
│ Pin12: 3.3V                             │
│                                         │
│ ESD保护: D17, D18 (SRV05-4)             │
└─────────────────────────────────────────┘
```

---

## 七、关键信号汇总表

### 7.1 I2S总线（音频）

| 信号 | GPIO | 方向 | 连接 | 速率 |
|:---|:---|:---|:---|:---|
| I2S_MCLK | GPIO2 | Output | ES7243E, ES8156 | 12.288MHz (256×48kHz) |
| I2S_SCLK | GPIO17 | Output | ES7243E, ES8156 | 3.072MHz (64×48kHz) |
| I2S_LRCK | GPIO47 | Output | ES7243E, ES8156 | 48kHz |
| I2S_ADC_SDOUT | GPIO16 | Input | ES7243E | 数据输入 |
| I2S_DAC_SDIN | GPIO15 | Output | ES8156 | 数据输出 |

### 7.2 I2C总线（控制）

| 信号 | GPIO | 方向 | 连接设备 | 地址 |
|:---|:---|:---|:---|:---|
| I2C_SCL | GPIO18 | Output | ES7243E, ES8156, ICM-42670 | - |
| I2C_SDA | GPIO8 | Bidir | ES7243E, ES8156, ICM-42670 | - |

**设备地址:**
- ES7243E: 0x20-0x27 (可配置)
- ES8156: 0x10 (固定)
- ICM-42670: 0x68/0x69 (NC未贴)

### 7.3 SPI总线（LCD）

| 信号 | GPIO | 方向 | 连接 | 速率 |
|:---|:---|:---|:---|:---|
| LCD_SCK | GPIO7 | Output | ST7789V | 40MHz max |
| LCD_SDA | GPIO6 | Output | ST7789V | MOSI |
| LCD_CS | GPIO5 | Output | ST7789V | 低有效 |
| LCD_DC | GPIO4 | Output | ST7789V | 0=命令,1=数据 |
| LCD_RST | GPIO48 | Output | ST7789V | 低有效 |
| LCD_CTRL | GPIO45 | Output | AO3401A | 背光控制 |

---

## 八、规格书vs原理图对照确认

| 规格书参数 | 原理图确认 | 状态 |
|:---|:---|:---|
| 2.4-inch LCD, 240×320 | ST7789V驱动, J7接口 | ✅ 匹配 |
| SPI Interface, 40MHz | GPIO5-7,48 | ✅ 匹配 |
| Driver IC: ST7789V | 确认使用 | ✅ 匹配 |
| Dual Mic | ES7243E + 2×MSM381A | ✅ 匹配 |
| ADC Model: ES7243 | ES7243E | ✅ 匹配 |
| Codec Model: ES8156 | ES8156 | ✅ 匹配 |
| PA Model: NS4150 | NS4150 | ✅ 匹配 |
| Mute: Supported | GPIO46控制PA_CTRL | ✅ 匹配 |
| 5V - 2.0A Input | USB-C, SY8088AAC×2 | ✅ 匹配 |
| FreeRTOS / ESP-IDF | 软件支持 | ✅ 匹配 |

---

## 九、设计特点总结

1. **AIoT优化**: ESP32-S3支持AI加速，配合双麦克风实现语音唤醒
2. **完整音频链**: ES7243(ADC) → ESP32-S3 → ES8156(DAC) → NS4150(PA)
3. **独立电源域**: MCU_VDD和VDD33分离，降低数字噪声
4. **灵活扩展**: PMOD1/2提供丰富的GPIO扩展能力
5. **ESD全面保护**: 所有外部接口均配备TVS保护
6. **紧凑设计**: 62.6×52.2×9.5mm尺寸，适合嵌入式应用