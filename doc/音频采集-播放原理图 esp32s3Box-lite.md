我来分析这两份ESP32-S3-BOX-Lite的电路原理图文档，总结ADC和DAC相关的电路设计。

## ESP32-S3-BOX-Lite ADC/DAC电路设计总结

---

### 一、系统概述

ESP32-S3-BOX-Lite开发板采用**双麦克风(AMIC x2)**音频输入方案，通过专用ADC芯片将模拟音频转换为数字信号，同时通过DAC芯片和功率放大器(PA)实现音频输出功能。音频系统采用**I2S数字音频接口**与主控ESP32-S3通信。

---

### 二、ADC电路设计（模拟输入）

#### 2.1 主ADC芯片：ES7243E

| 项目 | 详情 |
|:---|:---|
| **芯片型号** | ES7243E |
| **功能** | 双通道音频ADC（模数转换器） |
| **通信接口** | I2S（数字音频接口）+ I2C（控制接口） |
| **I2C地址** | `0010 AD2 AD1 AD0`（可配置）|

#### 2.2 麦克风输入电路（MIC子板）

| 项目 | 详情 |
|:---|:---|
| **麦克风类型** | 模拟MEMS麦克风（MSM381A3729H9BPC）|
| **数量** | 2个（立体声/双麦克风阵列）|
| **偏置电压** | ADC_MICBIAS12（1.2V偏置）|

**麦克风信号链路：**
```
麦克风 → 隔直电容 → ADC输入引脚
```

| 信号名称 | 对应引脚 | 说明 |
|:---|:---|:---|
| ADC_MIC1P | ES7243E Pin 16 | 麦克风1正输入 |
| ADC_MIC1N | ES7243E Pin 15 | 麦克风1负输入 |
| ADC_MIC2P | ES7243E Pin 9 | 麦克风2正输入 |
| ADC_MIC2N | ES7243E Pin 10 | 麦克风2负输入 |

#### 2.3 ES7243E与ESP32-S3连接

| ES7243E引脚功能 | ESP32-S3 GPIO | 信号名称 | 说明 |
|:---|:---|:---|:---|
| I2S数据输出 | GPIO16 | I2S_ADC_SDOUT | ADC数字音频数据输出 |
| I2S主时钟 | GPIO2 | I2S_MCLK | 主时钟 |
| I2S位时钟 | GPIO17 | I2S_SCLK | 串行时钟 |
| I2S帧时钟 | GPIO47 | I2S_LRCK | 左右声道时钟 |
| I2C时钟 | GPIO18 | I2C_SCL | 控制接口时钟 |
| I2C数据 | GPIO8 | I2C_SDA | 控制接口数据 |

---

### 三、DAC电路设计（模拟输出）

#### 3.1 DAC芯片：ES8156

| 项目 | 详情 |
|:---|:---|
| **芯片型号** | ES8156 |
| **功能** | 立体声音频DAC（数模转换器）+ 耳机驱动 |
| **通信接口** | I2S（数字音频接口）+ I2C（控制接口）|
| **I2C地址** | `0001 000`（0x10）|

#### 3.2 ES8156与ESP32-S3连接

| ES8156引脚功能 | ESP32-S3 GPIO | 信号名称 | 说明 |
|:---|:---|:---|:---|
| I2S数据输入 | GPIO15 | I2S_DAC_SDIN | DAC数字音频数据输入 |
| I2S主时钟 | GPIO2 | I2S_MCLK | 主时钟（与ADC共享）|
| I2S位时钟 | GPIO17 | I2S_SCLK | 串行时钟（与ADC共享）|
| I2S帧时钟 | GPIO47 | I2S_LRCK | 左右声道时钟（与ADC共享）|
| I2C时钟 | GPIO18 | I2C_SCL | 控制接口时钟（与ADC共享）|
| I2C数据 | GPIO8 | I2C_SDA | 控制接口数据（与ADC共享）|

#### 3.3 音频输出链路

```
ES8156 DAC输出 → 隔直电容 → 功率放大器(PA) → 扬声器
```

| 信号名称 | 说明 |
|:---|:---|
| DAC_AOUTLP / DAC_AOUTLN | 左声道差分输出 |
| DAC_AOUTRP / DAC_AOUTRN | 右声道差分输出 |

---

### 四、功率放大器(PA)电路

| 项目 | 详情 |
|:---|:---|
| **芯片型号** | NS4150 |
| **功能** | D类音频功率放大器 |
| **输出功率** | 3W（典型值）|
| **供电电压** | USB_5V |

**控制信号：**
| 信号 | ESP32-S3 GPIO | 说明 |
|:---|:---|:---|
| PA_CTRL | GPIO46 | 功放使能控制（低电平有效）|

---

### 五、I2S总线共享架构

```
┌─────────────────┐
│   ESP32-S3      │
│                 │
│  GPIO2  ────────┼──→ I2S_MCLK ──┬──→ ES7243E (ADC)
│  GPIO17 ────────┼──→ I2S_SCLK ──┼──→ ES8156  (DAC)
│  GPIO47 ────────┼──→ I2S_LRCK ──┤
│  GPIO16 ←───────┼─── I2S_ADC_SDOUT (ADC数据输入)
│  GPIO15 ────────┼──→ I2S_DAC_SDIN  (DAC数据输出)
│                 │
│  GPIO18 ────────┼──→ I2C_SCL ────┬──→ ES7243E
│  GPIO8  ────────┼──→ I2C_SDA ────┴──→ ES8156
│                 │
│  GPIO46 ────────┼──→ PA_CTRL (功放控制)
└─────────────────┘
```

---

### 六、GPIO引脚分配汇总

| GPIO | 功能 | 方向 | 连接芯片 |
|:---|:---|:---|:---|
| GPIO2 | I2S_MCLK | 输出 | ES7243E, ES8156 |
| GPIO8 | I2C_SDA | 双向 | ES7243E, ES8156 |
| GPIO15 | I2S_DAC_SDIN | 输出 | ES8156 |
| GPIO16 | I2S_ADC_SDOUT | 输入 | ES7243E |
| GPIO17 | I2S_SCLK | 输出 | ES7243E, ES8156 |
| GPIO18 | I2C_SCL | 输出 | ES7243E, ES8156 |
| GPIO46 | PA_CTRL | 输出 | NS4150 |
| GPIO47 | I2S_LRCK | 输出 | ES7243E, ES8156 |

---

### 七、电源设计

| 电源域 | 电压 | 用途 | 来源 |
|:---|:---|:---|:---|
| Aud_VDD | 3.3V | 音频芯片模拟电源 | SY8088AAC Buck |
| ADC_3V3 | 3.3V | ADC电源 | 独立LDO |
| USB_5V | 5V | 功放电源 | USB Type-C输入 |

---

### 八、设计特点

1. **双麦克风阵列**：支持立体声录音和波束成形算法
2. **I2S总线共享**：ADC和DAC共享I2S时钟线，节省GPIO资源
3. **独立I2C控制**：通过同一I2C总线配置不同地址的音频芯片
4. **D类功放**：高效率音频输出，适合电池供电场景
5. **完整ESD保护**：音频接口配备TVS二极管保护

---

### 九、关键芯片清单

| 位号 | 型号 | 功能 | 封装 |
|:---|:---|:---|:---|
| U4 | ES7243E | 双通道ADC | QFN |
| U16 | ES8156 | 立体声DAC | QFN |
| U10 | NS4150 | D类功放 | SOP-8 |
| U1, U2 | MSM381A3729H9BPC | MEMS麦克风 | 顶部进声 |

---

这份设计构成了ESP32-S3-BOX-Lite完整的音频子系统，支持语音唤醒、语音识别和音频播放功能。