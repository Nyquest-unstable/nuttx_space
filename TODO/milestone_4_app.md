# Milestone 4: 应用层集成 (Week 7-8)

## 目标
完成AI语音助手的应用层开发，包括唤醒词检测、对话状态机和UI界面。

---

## 4.1 唤醒词检测
- [ ] **方案选择**
  - 方案A: 本地唤醒 (Snowboy/Porcupine)
  - 方案B: 云端VAD+关键词 (小智方案)
  
- [ ] **本地唤醒实现** (如选A)
  - 移植唤醒词引擎
  - 低功耗监听模式
  - 唤醒后全功能启动

## 4.2 对话状态机
```
状态定义:
├── IDLE (空闲)
├── LISTENING (监听中) - VAD触发
├── THINKING (处理中) - 上传云端
├── SPEAKING (播放中) - TTS输出
└── ERROR (错误恢复)
```

- [ ] **状态转换实现**
  - 事件驱动架构
  - 超时处理
  - 打断逻辑 (按键打断)

## 4.3 UI界面开发
- [ ] **显示状态设计**
  - 待机界面: 时间/天气/提示
  - 聆听界面: 波形动画
  - 思考界面: 加载动画
  - 说话界面: 机器人形象
  
- [ ] **LVGL界面实现**
  - 屏幕布局 (240x320)
  - 动画效果
  - 状态同步

## 4.4 小智协议完整适配
- [ ] **功能对接**
  - 连续对话支持
  - 上下文记忆
  - 技能调用 (IoT控制)
  
- [ ] **音频优化**
  - AEC回声消除 (防止自激)
  - 噪声抑制 (NS)
  - 自动增益 (AGC)

## 4.5 系统调优
- [ ] **性能优化**
  - CPU占用监控
  - 内存使用优化 (PSRAM 8MB)
  - 延迟优化 (端到端<500ms)
  
- [ ] **稳定性测试**
  - 长时间运行测试
  - 网络抖动处理
  - 异常恢复机制

## 成功标准
- [ ] 唤醒词检测准确可靠
- [ ] 对话状态机运行稳定
- [ ] UI界面响应流畅，视觉效果良好
- [ ] 完整的小智协议功能对接
- [ ] 整体系统性能和稳定性达标